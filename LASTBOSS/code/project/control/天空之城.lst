C51 COMPILER V9.05   ________                                                              05/24/2021 15:25:55 PAGE 1   


C51 COMPILER V9.05, COMPILATION OF MODULE ________
OBJECT MODULE PLACED IN .\天空之城.obj
COMPILER INVOKED BY: L:\单片机\keil\KEIL4\C51\BIN\C51.EXE ..\..\..\..\..\keil project\buzzer\天空之城.c BROWSE DEBUG OBJ
                    -ECTEXTEND PRINT(.\天空之城.lst) OBJECT(.\天空之城.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          
   4          void bofangyingyue();
   5          
   6          sbit   speaker = P1^0;
   7          unsigned char timer0h, timer0l, time;
   8          
   9          //--------------------------------------
  10          // 单片机晶振采用 11.0592MHz
  11          // 频率- 半周期数据表 高八位 本软件共保存了四个八度的 28 个频率数据
  12          code unsigned char FREQH[] = {
  13                                          0xF2, 0xF3, 0xF5, 0xF5, 0xF6, 0xF7, 0xF8,       // 低音 1234567
  14                                          0xF9, 0xF9, 0xFA, 0xFA, 0xFB, 0xFB, 0xFC, 0xFC, // 中音1,2,3,4,5,6,7,i
  15                                          0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFE,             // 高音 234567
  16                                          0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF        // 超高音 1234567
  17                                       };
  18          // 频率- 半周期数据表 低八位
  19          code unsigned char FREQL[] = {
  20                                          0x42, 0xC1, 0x17, 0xB6, 0xD0, 0xD1, 0xB6,       // 低音 1234567
  21                                          0x21, 0xE1, 0x8C, 0xD8, 0x68, 0xE9, 0x5B, 0x8F, // 中音1,2,3,4,5,6,7,i
  22                                          0xEE, 0x44, 0x6B, 0xB4, 0xF4, 0x2D,             // 高音 234567
  23                                          0x47, 0x77, 0xA2, 0xB6, 0xDA, 0xFA, 0x16        // 超高音 1234567
  24                                       };
  25          
  26          code unsigned char sszymmh[] = {
  27                                              0,0,2,  0,0,2,  0,0,2,  6,1,1,  7,1,1,
  28                                              1,2,3,  7,1,1,  1,2,2,  3,2,2,
  29                                              7,1,4,  0,2,2,  3,1,1,  3,1,1,
  30                                              6,1,3,  5,1,1,  6,1,2,  1,2,2,
  31                                              5,1,4,  0,1,2,  3,1,2,
  32                                              4,1,3,  3,1,1,  4,1,2,  1,2,2,
  33                                              3,1,3,  0,0,1,  1,2,1,  1,2,1,  1,2,1,
  34                                              7,1,3,  4,1,1,  4,1,2,  7,1,2,
  35                                              7,1,4,  0,0,2,  6,1,1,  7,1,1,
  36                                              1,2,3,  7,1,1,  1,2,2,  3,2,2,
  37                                              7,1,4,  0,0,2,  3,1,1,  3,1,1,
  38                                              6,1,3,  5,1,1,  6,1,2,  1,2,2,
  39                                              5,1,4,  0,0,2,  2,1,1,  3,1,1,
  40                                              4,1,2,  1,2,1,  7,1,2,  1,2,3,
  41                                              2,2,1,  2,2,1,  3,2,1,  1,2,3,  0,0,2,
  42                                              1,2,1,  7,1,1,  6,1,1,  6,1,1,  7,1,2,  5,1,2,
  43                                              6,1,4,  0,0,2,  1,2,1,  2,2,1,
  44                                              3,2,3,  2,2,1,  3,2,2,  5,2,2,
  45                                              2,2,4,  0,0,2,  5,1,1,  5,1,1,
  46                                              1,2,3,  7,1,1,  1,2,2,  3,2,2,
  47                                              3,2,4,  0,0,2,  0,0,2,
  48                                              6,1,1,  7,1,1,  1,2,2,  7,1,2,  2,2,1,  2,2,1,
  49                                              1,2,3,  5,1,1,  5,1,3,  0,0,1,
  50                                              4,2,2,  3,2,2,  2,2,2,  1,2,2,
  51                                              3,2,4,  0,0,2,  3,2,2,
  52                                              6,2,4,  5,2,2,  5,2,2,
  53                                              3,2,1,  2,2,1,  1,2,4,  0,2,1,  1,2,1,
  54                                              2,2,2,  1,2,1,  2,2,1,  2,2,2,  5,2,2,
C51 COMPILER V9.05   ________                                                              05/24/2021 15:25:55 PAGE 2   

  55                                              3,2,4,  0,2,2,  3,2,2,
  56                                              6,2,4,  5,2,4,
  57                                              3,2,1,  2,2,1,  1,2,4,  0,0,1,  1,2,1,
  58                                              2,2,2,  1,2,1,  2,2,1,  2,2,2,  7,1,2,
  59                                              6,1,2,
  60                                         };
  61          
  62          void t0int() interrupt 1 //T0 中断程序，控制发音的音调
  63          {
  64   1          TR0 = 0; // 先关闭 T0
  65   1          speaker = !speaker; // 输出方波 , 发音
  66   1          TH0 = timer0h; // 下次的中断时间 , 这个时间 , 控制音调高低
  67   1          TL0 = timer0l;
  68   1          TR0 = 1; // 启动 T0
  69   1      }
  70          //--------------------------------------
  71          void delay(unsigned char t) // 延时程序，控制发音的时间长度
  72          {
  73   1          unsigned char t1;
  74   1          unsigned long t2;
  75   1          for(t1 = 0; t1 < t; t1++) // 双重循环 , 共延时 t 个半拍
  76   1              for(t2 = 0; t2 < 8000; t2++); // 延时期间 , 可进入 T0 中断去发音
  77   1          TR0 = 0; // 关闭 T0, 停止发音
  78   1      }
  79          //--------------------------------------
  80          void song() // 演奏一个音符
  81          {
  82   1          TH0 = timer0h; // 控制音调
  83   1          TL0 = timer0l;
  84   1          TR0 = 1; // 启动 T0, 由 T0输出方波去发音
  85   1          delay(time); // 控制时间长度
  86   1      }
  87          //--------------------------------------
  88          void bofangyingyue()
  89          {
  90   1          unsigned char k, i;
  91   1          //TMOD = 1; // 置 T0 定时工作方式 1
  92   1          //ET0 = 1; // 开 T0 中断
  93   1          //EA = 1; // 开 CPU中断
  94   1      
  95   1      
  96   1      
  97   1              i = 0;
  98   1              time = 1;
  99   1              while(time)
 100   1              {
 101   2                  k = sszymmh[i] + 7 * sszymmh[i + 1] - 1;
 102   2                  // 第 i 个是音符 , 第 i+1 个是第几个八度
 103   2                  timer0h = FREQH[k]; // 从数据表中读出频率数值
 104   2                  timer0l = FREQL[k]; // 实际上 , 是定时的时间长度
 105   2                  time = sszymmh[i + 2]; // 读出时间长度数值
 106   2                  i += 3;
 107   2                  song(); // 发出一个音符
 108   2              }
 109   1      }
 110          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    163    ----
   CONSTANT SIZE    =    455    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.05   ________                                                              05/24/2021 15:25:55 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
